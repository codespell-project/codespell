# vim ft=yaml
# Multiple lines can be made a single "virtual line" because of how Travis
# munges each line before executing it to print out the exit status.  It's okay
# for it to be on multiple physical lines, so long as you remember: - There
# can't be any leading "-"s - All newlines will be removed, so use ";"s

dist: bionic
language: python
cache: pip
python:
  - 3.5
  - 3.6
  - 3.7
  - 3.8
env:
  REQUIRE_ASPELL=true

addons:
  apt:
    packages:
      - libaspell-dev
      - aspell-en

before_install:
    - source tools/travis_tools.sh
    - SRC_DIR=$PWD
    - cd ~
    - virtualenv --python=python venv
    - source venv/bin/activate
    - python --version  # just to check
    - pip install -U pip wheel # upgrade to latest pip find 3.5 wheels; wheel to avoid errors
    - retry pip install pytest pytest-cov pytest-dependency flake8 coverage codecov chardet "setuptools!=47.2.0" docutils check-manifest
    - retry pip install aspell-python-py3
    - cd $SRC_DIR
    - wget "http://app.aspell.net/create?max_size=95&spelling=US&spelling=GBs&spelling=GBz&spelling=CA&spelling=AU&max_variant=2&diacritic=both&special=hacker&special=roman-numerals&encoding=utf-8&format=inline&download=aspell" -O customdict.tar.bz2
    - tar xjf customdict.tar.bz2
    - cd aspell6-en-custom
    - ./configure
    - make
    - cd $SRC_DIR

install:
    - python setup.py install

script:
    - codespell --help
    - make check-dictionary
    - codespell --skip="codespell_lib/tests/test_basic.py,codespell_lib/data/*" codespell_lib/
    # this file has an error
    - "! codespell codespell_lib/tests/test_basic.py"
    - flake8
    - python setup.py check --restructuredtext --strict
    - pytest codespell_lib
    - make check-manifest

after_success:
    - codecov
